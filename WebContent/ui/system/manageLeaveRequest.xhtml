<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	template="/common/commonLayout.xhtml">

	<ui:define name="content">
		<f:view>
			<h:head>
				<title>Leave Request Management</title>
			</h:head>

			<h:body>
				<div class="leave-container">

					<!-- Leave Request Form -->
					<p:panel header="New Leave Request">
						<h:form id="leaveForm" enctype="multipart/form-data">
							<p:growl id="messages" showDetail="true" life="3000" />

							<div class="ui-g">
								<div class="ui-g-12 ui-md-6">
									<p:outputLabel for="leaveType" value="Leave Type *" />
									<p:selectOneMenu id="leaveType"
										value="#{ManageLeaveRequestActionBean.leaveRequest.leaveType}"
										required="true">
										<f:selectItem itemLabel="Select Leave Type" itemValue="" />
										<f:selectItem itemLabel="Annual Leave" itemValue="ANNUAL" />
										<f:selectItem itemLabel="Sick Leave" itemValue="SICK" />
										<f:selectItem itemLabel="Maternity Leave"
											itemValue="MATERNITY" />
										<f:selectItem itemLabel="Paternity Leave"
											itemValue="PATERNITY" />
										<f:selectItem itemLabel="Unpaid Leave" itemValue="UNPAID" />
									</p:selectOneMenu>
								</div>

								<div class="ui-g-12 ui-md-6">
									<p:outputLabel for="startDate" value="Start Date *" />
									<p:calendar id="startDate"
										value="#{ManageLeaveRequestActionBean.leaveRequest.startDate}"
										pattern="dd-MM-yyyy" required="true" />
								</div>

								<div class="ui-g-12 ui-md-6">
									<p:outputLabel for="endDate" value="End Date *" />
									<p:calendar id="endDate"
										value="#{ManageLeaveRequestActionBean.leaveRequest.endDate}"
										pattern="dd-MM-yyyy" required="true" />
								</div>

								<div class="ui-g-12">
									<p:outputLabel for="reason" value="Reason *" />
									<p:inputTextarea id="reason"
										value="#{ManageLeaveRequestActionBean.leaveRequest.reason}" rows="4"
										cols="50" required="true" />
								</div>

								<!-- Medical Record Upload -->
								<div class="ui-g-12">
									<p:outputLabel for="medicalRecord"
										value="Medical Record (Image)" />
									<p:fileUpload id="medicalRecord"
										value="#{ManageLeaveRequestActionBean.file}" mode="simple"
										skinSimple="true" allowTypes="/(\.|\/)(gif|jpe?g|png)$/"
										label="Choose Image" />
								</div>

								<div class="ui-g-12" style="margin-top: 20px;">
									<p:commandButton value="Submit"
										action="#{ManageLeaveRequestActionBean.save()}"
										update=":leaveForm:messages :listForm:leaveTable" />
									<p:commandButton value="Reset" type="reset" />
								</div>
							</div>
						</h:form>
					</p:panel>

					<!-- Data Table -->
					<p:panel header="Existing Leave Requests">
						<h:form id="listForm">
							<p:dataTable id="leaveTable" var="request"
								value="#{ManageLeaveRequestActionBean.leaveRequests}" paginator="true"
								rows="10" emptyMessage="No leave requests found">

								<p:column headerText="Leave Type">
									<h:outputText value="#{request.leaveType}" />
								</p:column>

								<p:column headerText="Start Date">
									<h:outputText value="#{request.startDate}">
										<f:convertDateTime pattern="dd-MMM-yyyy" />
									</h:outputText>
								</p:column>

								<p:column headerText="End Date">
									<h:outputText value="#{request.endDate}">
										<f:convertDateTime pattern="dd-MMM-yyyy" />
									</h:outputText>
								</p:column>

								<p:column headerText="Reason">
									<h:outputText value="#{request.reason}" />
								</p:column>

								<p:column headerText="Medical Record">
									<p:graphicImage
										value="#{ManageLeaveRequestActionBean.getMedicalRecordImage(request)}"
										style="width:80px;height:80px;" cache="false" />
								</p:column>

								<p:column headerText="Status">
									<h:outputText value="#{request.status}" />
								</p:column>

								<p:column headerText="Actions" style="width:120px">
									<p:commandButton icon="ui-icon-pencil" title="Edit"
										update=":editForm" oncomplete="PF('editDialog').show()">
										<f:setPropertyActionListener value="#{request}"
											target="#{ManageLeaveRequestActionBean.selectedLeaveRequest}" />
									</p:commandButton>

									<p:commandButton icon="ui-icon-trash" title="Delete"
										action="#{ManageLeaveRequestActionBean.delete(request)}"
										update=":listForm:leaveTable :leaveForm:messages">
										<p:confirm header="Confirmation"
											message="Are you sure you want to delete this leave request?"
											icon="ui-icon-alert" />
									</p:commandButton>
								</p:column>
							</p:dataTable>

							<p:confirmDialog global="true">
								<p:commandButton value="Yes" type="button"
									styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="No" type="button"
									styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</p:confirmDialog>
						</h:form>
					</p:panel>

					<!-- Edit Dialog -->
					<p:dialog header="Edit Leave Request" widgetVar="editDialog"
						modal="true" resizable="false" style="width:600px">
						<h:form id="editForm" enctype="multipart/form-data">
							<div class="ui-g">
								<div class="ui-g-12 ui-md-6">
									<p:outputLabel value="Leave Type *" />
									<p:inputText
										value="#{ManageLeaveRequestActionBean.selectedLeaveRequest.leaveType}"
										required="true" />
								</div>

								<div class="ui-g-12 ui-md-6">
									<p:outputLabel value="Start Date *" />
									<p:calendar
										value="#{ManageLeaveRequestActionBean.selectedLeaveRequest.startDate}"
										pattern="dd-MM-yyyy" required="true" />
								</div>

								<div class="ui-g-12 ui-md-6">
									<p:outputLabel value="End Date *" />
									<p:calendar
										value="#{ManageLeaveRequestActionBean.selectedLeaveRequest.endDate}"
										pattern="dd-MM-yyyy" required="true" />
								</div>

								<div class="ui-g-12">
									<p:outputLabel value="Reason *" />
									<p:inputTextarea
										value="#{ManageLeaveRequestActionBean.selectedLeaveRequest.reason}"
										rows="4" cols="50" required="true" />
								</div>

								<!-- Medical Record Upload (Edit) -->
								<div class="ui-g-12">
									<p:outputLabel value="Medical Record (Image)" />
									<p:fileUpload value="#{ManageLeaveRequestActionBean.file}"
										mode="simple" skinSimple="true"
										allowTypes="/(\.|\/)(gif|jpe?g|png)$/" />
									<p:graphicImage
										value="#{ManageLeaveRequestActionBean.getMedicalRecordImage(ManageLeaveRequestActionBean.selectedLeaveRequest)}"
										style="width:80px;height:80px;margin-top:10px;" cache="false" />
								</div>

								<div class="ui-g-12"
									style="margin-top: 20px; text-align: right;">
									<p:commandButton value="Update"
										action="#{ManageLeaveRequestActionBean.update()}"
										update=":listForm:leaveTable :leaveForm:messages"
										oncomplete="PF('editDialog').hide()" />
									<p:commandButton value="Cancel"
										onclick="PF('editDialog').hide()" type="button" />
								</div>
							</div>
						</h:form>
					</p:dialog>
				</div>
			</h:body>
		</f:view>
	</ui:define>
</ui:composition>
